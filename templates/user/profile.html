{% extends 'base.html' %}
{% block title %}Profile{% endblock %}

{% block content %}

<style>
    body {
        background: rgb(99, 39, 120)
    }

    .form-control:focus {
        box-shadow: none;
        border-color: #BA68C8
    }

    .profile-button {
        background: rgb(99, 39, 120);
        box-shadow: none;
        border: none
    }

    .profile-button:hover {
        background: #682773
    }

    .profile-button:focus {
        background: #682773;
        box-shadow: none
    }

    .profile-button:active {
        background: #682773;
        box-shadow: none
    }

    .back:hover {
        color: #682773;
        cursor: pointer
    }

    .labels {
        font-size: 11px
    }

    .add-experience:hover {
        background: #BA68C8;
        color: #fff;
        cursor: pointer;
        border: solid 1px #BA68C8
    }
</style>

<div class="container rounded bg-white mt-5 mb-5">

    <div class="row">
        <div class="col-md-3 border-right">
            <div class="d-flex flex-column align-items-center text-center p-3 py-5">
                <label for="file-upload" class="custom-file-upload">
                    <svg width="148px" height="148px" viewBox="0 0 22 22" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
                        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                        <g id="SVGRepo_iconCarrier">
                            <title>profile_image_plus_round [#1327]</title>
                            <desc>Created with Sketch.</desc>
                            <defs> </defs>
                            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                <g id="Dribbble-Light-Preview" transform="translate(-340.000000, -2199.000000)"
                                    fill="#000000">
                                    <g id="icons" transform="translate(56.000000, 160.000000)">
                                        <path
                                            d="M306,2057.9552 C306,2058.5059 305.552,2058.95284 305,2058.95284 L304,2058.95284 L304,2060.00236 C304,2060.55306 303.552,2061 303,2061 C302.448,2061 302,2060.55306 302,2060.00236 L302,2058.95284 L301,2058.95284 C300.448,2058.95284 300,2058.5059 300,2057.9552 C300,2057.4045 300.448,2056.95755 301,2056.95755 L302,2056.95755 L302,2056.01179 C302,2055.46109 302.448,2055.01415 303,2055.01415 C303.552,2055.01415 304,2055.46109 304,2056.01179 L304,2056.95755 L305,2056.95755 C305.552,2056.95755 306,2057.4045 306,2057.9552 M294.623,2048.90958 C294.407,2048.89162 294.19,2048.87666 293.969,2048.87666 C293.766,2048.87666 293.567,2048.89162 293.368,2048.90658 C292.017,2048.61627 291,2047.41711 291,2045.98349 C291,2044.33339 292.346,2042.99057 294,2042.99057 C295.654,2042.99057 297,2044.33339 297,2045.98349 C297,2047.4201 295.979,2048.62226 294.623,2048.90958 M286.018,2055.95991 C286.004,2055.9649 286.014,2055.96091 286,2055.9659 L286,2041.98694 C286,2041.43624 286.448,2040.99528 287,2040.99528 L293.847,2040.99528 C291.157,2041.07709 289,2043.27689 289,2045.9805 C289,2047.4211 289.622,2048.71105 290.602,2049.62189 C288.124,2050.76918 286.332,2053.13758 286.018,2055.95991 M298.903,2044.97588 C298.493,2042.87085 296.631,2041.02721 294.066,2040.99528 L301,2040.99528 C301.552,2040.99528 302,2041.44223 302,2041.99293 L302,2050.9717 C302,2051.5224 302.448,2051.96935 303,2051.96935 C303.552,2051.96935 304,2051.5224 304,2050.9717 L304,2040.99528 C304,2039.89289 303.105,2039 302,2039 L286,2039 C284.895,2039 284,2039.89289 284,2040.99528 L284,2056.95755 C284,2058.05895 284.895,2058.95284 286,2058.95284 L296,2058.95284 C296.552,2058.95284 297,2058.5059 297,2057.9552 C297,2057.4045 296.552,2056.95755 296,2056.95755 L287.975,2056.95755 C287.974,2056.95755 287.969,2056.89171 287.969,2056.85081 C287.969,2050.76719 295.355,2049.96309 297.21,2051.68302 C298.283,2052.67767 299.674,2051.09242 298.596,2050.32922 C298.214,2050.05786 297.806,2049.81943 297.375,2049.61691 C298.589,2048.50254 299.264,2046.83249 298.903,2044.97588"
                                            id="profile_image_plus_round-[#1327]"> </path>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                    <input id="file-upload" type="file" style="display: none;">
                </label>
                <span class="font-weight-bold"> {{ current_user.surname }} {{ current_user.name }} </span>
                <span class="text-black-50">{{ current_user.email }}</span><span>
                </span>
            </div>
        </div>
        <div class="col-md-5 border-right">
            <div class="p-3 py-5">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-right">Profile Settings</h4>
                </div>
                <div class="row mt-2">
                    <div class="col-md-6"><label class="labels">Name</label>
                        <input type="text" class="form-control" placeholder="first name" id="name" name="name"
                            value="{{ current_user.name }}">
                    </div>
                    <div class="col-md-6"><label class="labels">Surname</label>
                        <input type="text" class="form-control" value="{{ current_user.surname }}" id="surname"
                            name="surname" placeholder="surname">
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12"><label class="labels">Email</label><input type="text" class="form-control"
                            placeholder="enter email" name="email" id="email" value="{{ current_user.email }}"></div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6"><label class="labels">Age</label>
                        <input type="number" class="form-control" name="age" id="age" placeholder="Age"
                            value="{{ current_user.age }}">
                    </div>
                </div>
                <div class="mt-5 text-center">
                    <button class="btn btn-primary profile-button edit-profile-button" type="submit">
                        Edit Profile
                    </button>
                    <button class="btn btn-danger profile-button" type="button"
                        data-bs-toggle="modal" data-bs-target="#set-password-modal">
                        Set password
                    </button>
                    <!-- Modal -->
                    <div class="modal fade" id="set-password-modal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Set password</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="mb-3">
                                            <label for="password" class="form-label">New password</label>
                                            <input type="password" class="form-control" id="password" name="password"
                                                required>
                                            <div class="invalid-feedback">
                                                Enter new password
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary set-password-button">Update password</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="p-3 py-5">
                <div class="col-md-12">
                    <h3>Tests passed</h3>
                    <h4><span class="badge text-bg-secondary">120</span></h4>
                </div>
                <br>
                <div class="col-md-12">
                    <h3>Tests Created</h3>
                    <h4><span class="badge text-bg-secondary">120</span></h4>
                </div>
                <br>
                <div class="col-md-12">
                    <h3>Scove</h3>
                    <h4><span class="badge text-bg-secondary">120</span></h4>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(".edit-profile-button").on('click', function () {
        let surname = $('#surname').val();
        let name = $('#name').val();
        let email = $('#email').val();
        let age = $('#age').val();
        $.ajax({
            url: "/profile",
            type: "POST",
            data: { surname, name, email, age },
            success: function (response) {
                location.reload()
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("Error: " + textStatus + ", " + errorThrown);
            }
        });
    });

    $(".set-password-button").on('click', function () {
        let new_password = $('#password').val();

        $.ajax({
            url: "/profile/updatepassword",
            type: "POST",
            data: { new_password, },
            success: function (response) {
                console.log(response);
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error("Error: " + textStatus + ", " + errorThrown);
            }
        });
    });
</script>

{% endblock %}